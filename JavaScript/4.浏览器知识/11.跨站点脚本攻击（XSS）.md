# 跨站点脚本攻击（XSS）

全称`Cross Site Script`

将一段恶意脚本添加到网页上，通过浏览器加载执行，从而获得Storage里面的隐私信息。

一般出现在同一域名下的多个Web应用程序，互相共享了存储对象，使得某些应用拿到了所有应用的数据

## 分为三类

### 反射型（Reflected XSS，非持久）

- 发生过程
    - 发出请求时，XSS恶意代码出现在URL参数中，作为输入提交到服务器
    - 服务器响应后用XSS代码渲染出HTML页面，传回浏览器，最后浏览器解析执行了XSS代码

- 由于需要用户主动打开恶意的URL才能生效，攻击者往往会结合多种手段诱导用户点击，可能会把长的恶意URL用工具生成短网址，形成二次跳转，更加隐蔽
    - 整个过程像一次反射，所以叫反射型XSS

- 防御办法
    - 对请求的参数进行检查，后端一定要做，发现可疑字符就拒绝
    - 把请求参数渲染到HTML页面前，先进行转义再显示
        - 使用`encodeURIComponent`
        - 比如把`<`符号转变为`&lt;`
    - 设置cookie为httpOnly，这样js就拿不到了

### 存储型（Stored XSS，持久）

- 发生过程
    - 恶意脚本被攻击者上传并保存到了服务器端的数据库
    - 普通用户打开网站，会从数据库中获取，然后在本地浏览器执行
    - 恶意脚本就会窃取用户数据并发送到攻击者的网站
    - 破坏性很强，获得了在网络上传播的能力

- 常见的场景是，黑客写下一篇包含有恶意JS代码的博客文章，文章发表后，所有访问该博客的用户，都会在他们的浏览器中执行这段恶意js代码

- 防御办法
    - 对请求的参数进行检查，后端一定要做，写入数据库前进行转义和过滤危险字符

### DOM型（也叫本地XSS）

- 前端JS代码不严谨，把不可信的内容插入到了页面
    - 是一种特殊的反射型，是基于DOM动态插入内容的一种漏洞

- 防御办法
    - 用.innerHTML、.outerHTML、.appendChild、document.write()等API时要特别小心
    - 不要把不可信的数据作为HTML插入到页面上
    - 尽量使用.innerText、.textContent、.setAttribut()等
